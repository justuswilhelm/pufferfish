#!/usr/bin/env fish
set output_file "$(mktemp).png"

if [ -z $argv[1] ]
    set message "Hello, World!"
else
    set message $argv[1]
end

if ! set font (fc-match sans file | cut -d= -f2)
    echo "Couldn't find font"
    set font_flag ""
else
    set font_flag -font $font
end

if ! convert \
    $font_flag \
    -size 1024x768 xc:white \
    -gravity center \
    -pointsize 24 \
    -fill black \
    -annotate +0+0 \
    $message \
    $output_file
    echo "Could not create idle message"
    set image_flag ""
else
    set image_flag --image $output_file
end

exec swaylock --show-failed-attempts --color ff6e67 $image_flag
